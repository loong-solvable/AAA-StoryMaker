# Agent 开发规范 (Agent Development Guidelines)

本文档汇总了项目关于 Agent 开发的核心规则与注意事项，源自 `.cursor/rules/` 配置。

## 1. 技术栈规范

*   **开发语言**：Python
*   **核心框架**：LangChain
*   **设计原则**：遵循低耦合（Low Coupling）原则，确保模块化和可插拔性。

## 2. 配置与安全

*   **环境变量**：所有敏感配置（如 API Key）必须存放在 `.env` 文件中。
*   **Git 忽略**：`.env` 文件必须添加到 `.gitignore` 中，严禁提交到版本控制系统。
*   **LLM 选择**：
    *   **首选**：OpenRouter (提供更多模型选择)。
    *   **兼容性**：代码应保留兼容其他主流 LLM（如 OpenAI、智谱 AI）的接口。

## 3. LLM 集成与超时处理 (Critical)

*   **超时检查**：在集成或切换 LLM 客户端时，必须检查默认超时设置（通常 SDK 默认为 60s，这对于长任务往往不够）,当我们处理长文本小说的时候，应当有足够长的超时设置。
*   **自定义封装**：
    *   必须实现自定义包装类（如 `CustomZhipuAI`）来继承或封装原始客户端。
    *   **显式覆盖超时设置**：在包装类中将默认超时设置为更高值（建议 300s 或 600s）。
    *   禁止直接使用默认的 SDK 客户端而不处理超时参数。

## 4. Prompt 工程规范

*   **独立存储**：
    *   严禁在 Python 代码中硬编码 Prompt。
    *   所有 Prompt 必须集中存放在项目的 `prompts/` 文件夹中。
*   **分类管理**：
    *   Prompt 文件应当按照功能或 Agent 模块进行分类存放（例如 `prompts/offline/`, `prompts/online/`）。
*   **规范化构建**：建议建立持久性、规范性的 Prompt 工程搭建与保存流程。

## 5. 开发行为准则

*   **日志监控**：
    *   必须实施日志打印，监控 Agent 运行状况。
    *   重要的运行日志应持久化保存到 `logs/` 文件夹。
*   **错误修复记录**：
    *   遇到并修复 Agent 相关的重要 bug（如超时、解析错误）时，应创建 `problem-fixed-*.md` 报告存放在 `docs/reports/` 中。
*   **工作报告与文档**：
    *   **修改报告**：帮助修改代码后，需生成工作报告存放于专门文件夹，保持根目录清晰。
    *   **进度管理**：每当敲定项目架构、流程或完成功能开发时，需更新根目录下的 `项目开发进度.md` 文件，列出功能和进度条。
    *   **测试代码**：用来测试的代码文件应当有一个专门的文件夹存放（如 `tests/`）。

## 6. 版本控制与存档

*   **Git 管理**：
    *   **初始化**：项目开始即进行 Git 管理。
    *   **提交频率**：每次对话/功能完成后进行提交。
    *   **提交描述**：使用中文描述。
    *   **版本控制**：附带版本号（自行决定版本号模式）。
    *   **推送策略**：默认只在本地管理，除非明确要求推送到云端。
