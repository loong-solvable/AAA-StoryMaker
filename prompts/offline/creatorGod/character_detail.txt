# Role
你是一名心理侧写师。现在你需要为小说中的角色 "{target_name}" 建立一份深度档案。

# Source Material
小说文本片段（见 User Input）。

# Characters List（角色普查表）
以下是阶段一角色普查确定的所有角色及其ID，在填写 relationship_matrix 时必须使用这些ID：
{characters_list}

# Requirements
请严格按照以下 JSON 结构提取信息。若文中未提及，请根据人设性格进行合理的逻辑推断（Inference），不要留空。

# JSON Schema Definition
{{
  "id": "{target_id}",
  "name": "{target_name}",
  "gender": "String",
  "age": "String",
  "importance": Float, // 使用之前普查阶段确定的数值
  
  "traits": [
    // 提取 3-5 个标签，涵盖身份、能力、性格、状态等
    // 必须简炼又明确
  ],

  "behavior_rules": [
    // 提取几条该角色的行为逻辑。
  ],

  "relationship_matrix": {{
    // 遍历文中出现的其他重要角色，描述 "{target_name}" 与他们的关系。
    // **重要：这里的 target_npc_id 必须使用上方角色普查表中的ID（如 npc_001, npc_002 等）**
    // 格式如下：
    "npc_XXX": {{  // 使用角色普查表中的ID
      "address_as": "String", //("{target_name}"怎么称呼该角色)
      "attitude": "String"//("{target_name}"内心对该角色的真实看法)
    }}
  }},

  "possessions": [
    // 角色的所有物。列出角色的固定资产和现在随身携带的物品
  ],

  "current_appearance": "String (一段用于生成画面的对该角色外貌描写)",

  "voice_samples": [
    // 摘录几句该角色原文台词，保留原汁原味的语气和标点。
  ]
}}

# Critical Constraints
1. **Output Format (CRITICAL):** 
   - Output ONLY the raw JSON object. 
   - Do NOT wrap it in markdown code blocks (like ```json ... ```). 
   - Do NOT include any explanations, comments, or additional text before or after the JSON.
   - Do NOT add any text after the closing brace }.
   - The response must start with {{ and end with }} with no other content.
   - Your entire response should be valid JSON that can be parsed directly by json.loads().

2. **Strict JSON Format:**
   - Must be valid JSON that can be parsed directly by json.loads()
   - No trailing commas
   - All strings must be properly escaped with double quotes
   - No comments in the output (even though the schema shows comments, the output must be pure JSON)
   - No extra whitespace or newlines after the closing brace

3. **ID Consistency:** 必须使用角色普查表中确定的ID。当前角色ID为 "{target_id}"，relationship_matrix 中引用其他角色时也必须使用普查表中的ID。

4. **Relationship Matrix:** 必须区分"面子"和"里子"。address_as 是口头称呼，attitude 是内心独白。二者可能一致也可能不一致。

5. **Traits:** 在能准确表达意思的基础上不要使用长句。

6. **Voice Samples:** 必须直接摘录原文，不要自己编造。

# Example Output Format
Your response should look exactly like this (no markdown, no extra text, no explanations):
{{
  "id": "npc_001",
  "name": "角色名",
  "gender": "男",
  "age": "30岁",
  "importance": 1.0,
  "traits": ["标签1", "标签2"],
  "behavior_rules": ["行为规则1"],
  "relationship_matrix": {{}},
  "possessions": ["物品1"],
  "current_appearance": "外貌描述",
  "voice_samples": ["台词1"]
}}
