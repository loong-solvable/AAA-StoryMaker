# æµ‹è¯•æµç¨‹ Mermaid æµç¨‹å›¾

## å®Œæ•´æµç¨‹æ¦‚è§ˆ

```mermaid
graph TB
    Start([å¼€å§‹æµ‹è¯•]) --> Cleanup[cleanup_full.py<br/>æ¸…ç†æ—§æ•°æ®]
    Cleanup --> CreatorGod[run_creator_god.py<br/>CreatorGod åˆ›ä¸–ç»„]
    CreatorGod --> Illuminati[IlluminatiInitializer<br/>å…‰æ˜ä¼šåˆå§‹åŒ–]
    Illuminati --> GameLoop[ä¸‰å¹•æ¸¸æˆå¾ªç¯]
    GameLoop --> End([æµ‹è¯•å®Œæˆ])
    
    style Start fill:#90EE90
    style End fill:#90EE90
    style CreatorGod fill:#87CEEB
    style Illuminati fill:#DDA0DD
    style GameLoop fill:#FFB6C1
```

## CreatorGod è¯¦ç»†æµç¨‹

```mermaid
graph LR
    A[example_novel.txt] --> B[å¤§ä¸­æ­£<br/>character_filter.txt]
    B --> C[characters_list.json]
    
    A --> D[Demiurge<br/>world_setting.txt]
    D --> E[world_setting.json]
    
    A --> F[è®¸åŠ­<br/>character_detail.txt]
    C --> F
    F --> G[character_npc_001.json]
    F --> H[character_npc_002.json]
    F --> I[... å…¶ä»–è§’è‰²]
    
    style B fill:#FFE4B5
    style D fill:#FFE4B5
    style F fill:#FFE4B5
    style C fill:#98FB98
    style E fill:#98FB98
    style G fill:#98FB98
    style H fill:#98FB98
    style I fill:#98FB98
```

## Illuminati åˆå§‹åŒ–æµç¨‹

```mermaid
graph TB
    A[world_setting.json] --> WS[WSåˆå§‹åŒ–<br/>ws_system.txt]
    B[characters_list.json] --> WS
    C[character_*.json] --> WS
    WS --> WS_OUT[world_state.json]
    
    A --> Plot[Plotåˆå§‹åŒ–<br/>plot_system.txt]
    B --> Plot
    C --> Plot
    WS_OUT --> Plot
    Plot --> Plot_OUT1[current_scene.json]
    Plot --> Plot_OUT2[current_script.json]
    
    A --> Vibe[Vibeåˆå§‹åŒ–<br/>vibe_system.txt]
    Plot_OUT1 --> Vibe
    Vibe --> Vibe_OUT[initial_atmosphere.json]
    
    style WS fill:#DDA0DD
    style Plot fill:#DDA0DD
    style Vibe fill:#DDA0DD
    style WS_OUT fill:#98FB98
    style Plot_OUT1 fill:#98FB98
    style Plot_OUT2 fill:#98FB98
    style Vibe_OUT fill:#98FB98
```

## å•å¹•æ¸¸æˆå¾ªç¯æµç¨‹

```mermaid
graph TB
    Start([å¹•å¼€å§‹]) --> Dispatch[å‰§æœ¬æ‹†åˆ†<br/>script_divider.txt]
    Dispatch --> Script1[npc_001_script.json]
    Dispatch --> Script2[npc_002_script.json]
    
    Start --> Init[è§’è‰²åˆå§‹åŒ–]
    Init --> Prompt1[npc_001_æ—æ™¨_prompt.txt]
    Init --> Agent1[npc_001_æ—æ™¨.py]
    
    Script1 --> Loop[åœºæ™¯å¯¹è¯å¾ªç¯]
    Script2 --> Loop
    Prompt1 --> Loop
    Agent1 --> Loop
    
    Loop --> React[NPC Agent.react]
    React --> Memory[scene_memory.json<br/>æ›´æ–°å¯¹è¯è®°å½•]
    Memory --> Route[OS.route_dialogue<br/>è·¯ç”±å†³ç­–]
    Route --> History[history.json<br/>ä¿å­˜è§’è‰²å†å²]
    
    Route -->|ç»§ç»­| React
    Route -->|ç»“æŸ| Transition[å¹•é—´å¤„ç†]
    
    Transition --> Archive[å½’æ¡£åœºæ™¯è®°å¿†<br/>all_scene_memory.json]
    Transition --> WSUpdate[WSæ›´æ–°<br/>ws_update_system.txt]
    Transition --> PlotGen[Plotç”Ÿæˆä¸‹ä¸€å¹•<br/>plot_system.txt]
    
    PlotGen --> ArchiveOld[_archive_plot_files<br/>å½’æ¡£æ—§å‰§æœ¬åˆ°history]
    ArchiveOld --> NewScene[current_scene.json æ–°]
    PlotGen --> NewScript[current_script.json æ–°]
    
    style Dispatch fill:#FFB6C1
    style Init fill:#FFB6C1
    style Loop fill:#FFB6C1
    style Transition fill:#87CEEB
    style ArchiveOld fill:#FFD700
```

## æ–‡ä»¶ä¾èµ–å…³ç³»å›¾

```mermaid
graph TB
    subgraph "è¾“å…¥æ–‡ä»¶"
        Novel[example_novel.txt]
        Prompts[æç¤ºè¯æ–‡ä»¶]
    end
    
    subgraph "CreatorGodè¾“å‡º"
        CL[characters_list.json]
        WS[world_setting.json]
        C1[character_npc_001.json]
        C2[character_npc_002.json]
        C3[...]
    end
    
    subgraph "Illuminatiè¾“å‡º"
        WS_RT[world_state.json]
        CS[current_scene.json]
        CSP[current_script.json]
        VIBE[initial_atmosphere.json]
    end
    
    subgraph "æ¸¸æˆè¿è¡Œè¾“å‡º"
        NS[npc_001_script.json]
        MEM[scene_memory.json]
        HIST[history.json]
        ASM[all_scene_memory.json]
        ARCH[history/scene_X.json]
    end
    
    Novel --> CL
    Novel --> WS
    Novel --> C1
    Novel --> C2
    
    CL --> WS_RT
    WS --> WS_RT
    C1 --> CS
    C2 --> CS
    WS_RT --> CS
    
    CS --> NS
    CSP --> NS
    NS --> MEM
    MEM --> HIST
    MEM --> ASM
    CS --> ARCH
    CSP --> ARCH
    
    style Novel fill:#FFE4B5
    style Prompts fill:#FFE4B5
    style CL fill:#98FB98
    style WS fill:#98FB98
    style C1 fill:#98FB98
    style ARCH fill:#FFD700
```

## æç¤ºè¯è°ƒç”¨é“¾

```mermaid
graph LR
    subgraph "ç¦»çº¿é˜¶æ®µ"
        P1[character_filter.txt] --> A1[å¤§ä¸­æ­£]
        P2[world_setting.txt] --> A2[Demiurge]
        P3[character_detail.txt] --> A3[è®¸åŠ­]
    end
    
    subgraph "åœ¨çº¿é˜¶æ®µ"
        P4[ws_system.txt] --> A4[WS]
        P5[plot_system.txt] --> A5[Plot]
        P6[vibe_system.txt] --> A6[Vibe]
        P7[script_divider.txt] --> A7[OS]
        P8[npc_system.txt] --> A8[NPC]
        P9[ws_update_system.txt] --> A4
    end
    
    style P1 fill:#FFE4B5
    style P2 fill:#FFE4B5
    style P3 fill:#FFE4B5
    style P4 fill:#DDA0DD
    style P5 fill:#DDA0DD
    style P6 fill:#DDA0DD
    style P7 fill:#FFB6C1
    style P8 fill:#FFB6C1
    style P9 fill:#FFB6C1
```

## æ•°æ®æµå‘å›¾

```mermaid
flowchart TD
    A[å°è¯´æ–‡æœ¬] -->|é˜¶æ®µ1| B[è§’è‰²åˆ—è¡¨]
    A -->|é˜¶æ®µ2| C[ä¸–ç•Œè®¾å®š]
    A -->|é˜¶æ®µ3| D[è§’è‰²æ¡£æ¡ˆ]
    
    B -->|Illuminati| E[åˆå§‹ä¸–ç•ŒçŠ¶æ€]
    C -->|Illuminati| E
    D -->|Illuminati| E
    
    E -->|Plot| F[èµ·å§‹åœºæ™¯]
    E -->|Plot| G[èµ·å§‹å‰§æœ¬]
    
    F -->|æ¯å¹•| H[å‰§æœ¬æ‹†åˆ†]
    G -->|æ¯å¹•| H
    
    H -->|ç”Ÿæˆ| I[è§’è‰²å°å‰§æœ¬]
    I -->|NPCæ¼”ç»| J[å¯¹è¯è®°å½•]
    J -->|å¹•é—´| K[åœºæ™¯å½’æ¡£]
    J -->|å¹•é—´| L[WSæ›´æ–°]
    J -->|å¹•é—´| M[Plotç”Ÿæˆä¸‹ä¸€å¹•]
    
    M -->|å½’æ¡£| N[historyç›®å½•]
    M -->|æ›´æ–°| F
    M -->|æ›´æ–°| G
    
    style A fill:#FFE4B5
    style B fill:#98FB98
    style C fill:#98FB98
    style D fill:#98FB98
    style E fill:#DDA0DD
    style F fill:#DDA0DD
    style G fill:#DDA0DD
    style N fill:#FFD700
```

---

**è¯´æ˜**: 
- ğŸŸ¢ ç»¿è‰²ï¼šç”Ÿæˆçš„æ•°æ®æ–‡ä»¶
- ğŸŸ¡ é»„è‰²ï¼šæç¤ºè¯æ–‡ä»¶
- ğŸŸ£ ç´«è‰²ï¼šIlluminatié˜¶æ®µ
- ğŸ”µ è“è‰²ï¼šæ¸¸æˆè¿è¡Œé˜¶æ®µ
- ğŸŸ  æ©™è‰²ï¼šè¾“å…¥æ–‡ä»¶
- ğŸŸ¨ é‡‘è‰²ï¼šå½’æ¡£æ–‡ä»¶ï¼ˆæ–°å¢åŠŸèƒ½ï¼‰

