# å®Œæ•´æµ‹è¯•æµç¨‹è°ƒç”¨é€»è¾‘ä¸æµç¨‹å›¾

**ç”Ÿæˆæ—¶é—´**: 2025-12-01  
**æµ‹è¯•è„šæœ¬**: `tests/test_three_scenes_flow.py`  
**æµ‹è¯•æµç¨‹**: CreatorGod â†’ Illuminati â†’ ä¸‰å¹•æ¸¸æˆå¾ªç¯

---

## ğŸ“‹ ç›®å½•

1. [æ•´ä½“æµç¨‹å›¾](#æ•´ä½“æµç¨‹å›¾)
2. [é˜¶æ®µ1: CreatorGod åˆ›ä¸–ç»„](#é˜¶æ®µ1-creatorgod-åˆ›ä¸–ç»„)
3. [é˜¶æ®µ2: Illuminati å…‰æ˜ä¼šåˆå§‹åŒ–](#é˜¶æ®µ2-illuminati-å…‰æ˜ä¼šåˆå§‹åŒ–)
4. [é˜¶æ®µ3: æ¸¸æˆè¿è¡Œå¾ªç¯](#é˜¶æ®µ3-æ¸¸æˆè¿è¡Œå¾ªç¯)
5. [æ–‡ä»¶æ¸…å•](#æ–‡ä»¶æ¸…å•)
6. [æç¤ºè¯æ¸…å•](#æç¤ºè¯æ¸…å•)
7. [JSONæ–‡ä»¶æ¸…å•](#jsonæ–‡ä»¶æ¸…å•)

---

## ğŸ¯ æ•´ä½“æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®Œæ•´æµ‹è¯•æµç¨‹                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  1. cleanup_full.py                â”‚
        â”‚  æ¸…ç†æ—§æ•°æ®                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  2. run_creator_god.py              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ GenesisGroup                 â”‚   â”‚
        â”‚  â”‚ â””â”€> CreatorGod               â”‚   â”‚
        â”‚  â”‚     â”œâ”€> å¤§ä¸­æ­£ (é˜¶æ®µ1)       â”‚   â”‚
        â”‚  â”‚     â”œâ”€> Demiurge (é˜¶æ®µ2)     â”‚   â”‚
        â”‚  â”‚     â””â”€> è®¸åŠ­ (é˜¶æ®µ3)         â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚  ç”Ÿæˆ: data/worlds/æ±ŸåŸå¸‚/           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  3. test_three_scenes_flow.py       â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ IlluminatiInitializer         â”‚   â”‚
        â”‚  â”‚ â”œâ”€> WSåˆå§‹åŒ–                  â”‚   â”‚
        â”‚  â”‚ â”œâ”€> Plotåˆå§‹åŒ–                â”‚   â”‚
        â”‚  â”‚ â””â”€> Vibeåˆå§‹åŒ–                â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚  ç”Ÿæˆ: data/runtime/æ±ŸåŸå¸‚_xxx/      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ OS Agent                      â”‚   â”‚
        â”‚  â”‚ â””â”€> ä¸‰å¹•å¾ªç¯                  â”‚   â”‚
        â”‚  â”‚     â”œâ”€> å‰§æœ¬æ‹†åˆ†              â”‚   â”‚
        â”‚  â”‚     â”œâ”€> è§’è‰²åˆå§‹åŒ–            â”‚   â”‚
        â”‚  â”‚     â”œâ”€> åœºæ™¯æ¼”ç»              â”‚   â”‚
        â”‚  â”‚     â””â”€> å¹•é—´å¤„ç†              â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ é˜¶æ®µ1: CreatorGod åˆ›ä¸–ç»„

### è°ƒç”¨é“¾

```
run_creator_god.py
  â””â”€> GenesisGroup.run()
      â””â”€> CreatorGod.run()
          â”œâ”€> stage1_character_census()  [å¤§ä¸­æ­£]
          â”‚   â””â”€> CharacterFilterAgent.run()
          â”‚       â”œâ”€> è¯»å–: prompts/offline/creatorGod/character_filter.txt
          â”‚       â”œâ”€> è¾“å…¥: data/novels/example_novel.txt
          â”‚       â””â”€> ç”Ÿæˆ: data/worlds/æ±ŸåŸå¸‚/characters_list.json
          â”‚
          â”œâ”€> stage2_world_setting()  [Demiurge]
          â”‚   â””â”€> WorldSettingAgent.run()
          â”‚       â”œâ”€> è¯»å–: prompts/offline/creatorGod/world_setting.txt
          â”‚       â”œâ”€> è¾“å…¥: data/novels/example_novel.txt
          â”‚       â””â”€> ç”Ÿæˆ: data/worlds/æ±ŸåŸå¸‚/world_setting.json
          â”‚
          â””â”€> stage3_character_profiles()  [è®¸åŠ­]
              â””â”€> CharacterDetailAgent.run()
                  â”œâ”€> è¯»å–: prompts/offline/creatorGod/character_detail.txt
                  â”œâ”€> è¾“å…¥: data/novels/example_novel.txt
                  â”‚         + characters_list.json (ç”¨äºIDä¸€è‡´æ€§)
                  â””â”€> ç”Ÿæˆ: data/worlds/æ±ŸåŸå¸‚/characters/character_npc_*.json
                      (ä¸ºæ¯ä¸ªè§’è‰²ç”Ÿæˆä¸€ä¸ªJSONæ–‡ä»¶)
```

### æ–‡ä»¶ç”Ÿæˆæ¸…å•

**è¾“å…¥æ–‡ä»¶:**
- `data/novels/example_novel.txt` (2330å­—å°è¯´æ–‡æœ¬)

**æç¤ºè¯æ–‡ä»¶:**
- `prompts/offline/creatorGod/character_filter.txt` (å¤§ä¸­æ­£æç¤ºè¯)
- `prompts/offline/creatorGod/world_setting.txt` (Demiurgeæç¤ºè¯)
- `prompts/offline/creatorGod/character_detail.txt` (è®¸åŠ­æç¤ºè¯) â­ **å·²ä¼˜åŒ–**

**è¾“å‡ºJSONæ–‡ä»¶:**
- `data/worlds/æ±ŸåŸå¸‚/characters_list.json` (è§’è‰²åˆ—è¡¨ï¼ŒåŒ…å«IDå’Œé‡è¦æ€§)
- `data/worlds/æ±ŸåŸå¸‚/world_setting.json` (ä¸–ç•Œè®¾å®šï¼šåœ°ç‚¹ã€è§„åˆ™ã€ç‰©ç†æ³•åˆ™)
- `data/worlds/æ±ŸåŸå¸‚/characters/character_npc_001.json` (æ—æ™¨)
- `data/worlds/æ±ŸåŸå¸‚/characters/character_npc_002.json` (è‹æ™´é›¨)
- `data/worlds/æ±ŸåŸå¸‚/characters/character_npc_003.json` (ç¥ç§˜ç”µè¯ç”·å­)
- `data/worlds/æ±ŸåŸå¸‚/characters/character_npc_004.json` (å¼ ç‘å³°)
- `data/worlds/æ±ŸåŸå¸‚/characters/character_npc_005.json` (é»‘è¡£ç”·å­)
- `data/worlds/æ±ŸåŸå¸‚/characters/character_npc_006.json` (æå©‰)
- `data/worlds/æ±ŸåŸå¸‚/characters/character_npc_007.json` (æ—æ™¨çš„æ¯äº²)
- `data/worlds/æ±ŸåŸå¸‚/characters/character_npc_008.json` (è€è®°è€…)

---

## ğŸ›ï¸ é˜¶æ®µ2: Illuminati å…‰æ˜ä¼šåˆå§‹åŒ–

### è°ƒç”¨é“¾

```
test_three_scenes_flow.py
  â””â”€> IlluminatiInitializer(world_name="æ±ŸåŸå¸‚")
      â”œâ”€> _load_world_setting()
      â”‚   â””â”€> è¯»å–: data/worlds/æ±ŸåŸå¸‚/world_setting.json
      â”‚
      â”œâ”€> _load_characters_list()
      â”‚   â””â”€> è¯»å–: data/worlds/æ±ŸåŸå¸‚/characters_list.json
      â”‚
      â”œâ”€> _load_all_characters()
      â”‚   â””â”€> è¯»å–: data/worlds/æ±ŸåŸå¸‚/characters/character_*.json
      â”‚
      â””â”€> initializer.run()
          â”œâ”€> init_world_state()  [WSåˆå§‹åŒ–]
          â”‚   â”œâ”€> è¯»å–: prompts/online/ws_system.txt
          â”‚   â”œâ”€> è¾“å…¥: world_setting.json + characters_list.json
          â”‚   â””â”€> ç”Ÿæˆ: data/runtime/æ±ŸåŸå¸‚_xxx/ws/world_state.json
          â”‚
          â”œâ”€> init_plot_and_generate_opening()  [Plotåˆå§‹åŒ–]
          â”‚   â”œâ”€> è¯»å–: prompts/online/plot_system.txt
          â”‚   â”œâ”€> è¾“å…¥: world_setting.json + characters_list.json
          â”‚   â”‚         + character_*.json + world_state.json
          â”‚   â”œâ”€> è§£æè§’è‰²ç™»åœºä¿¡æ¯ (å…¥åœº/åœ¨åœº/ç¦»åœº)
          â”‚   â””â”€> ç”Ÿæˆ: data/runtime/æ±ŸåŸå¸‚_xxx/plot/current_scene.json
          â”‚            data/runtime/æ±ŸåŸå¸‚_xxx/plot/current_script.json
          â”‚
          â””â”€> init_vibe_and_generate_atmosphere()  [Vibeåˆå§‹åŒ–]
              â”œâ”€> è¯»å–: prompts/online/vibe_system.txt
              â”œâ”€> è¾“å…¥: world_setting.json + current_scene.json
              â””â”€> ç”Ÿæˆ: data/runtime/æ±ŸåŸå¸‚_xxx/vibe/initial_atmosphere.json
```

### æ–‡ä»¶ç”Ÿæˆæ¸…å•

**è¾“å…¥æ–‡ä»¶:**
- `data/worlds/æ±ŸåŸå¸‚/world_setting.json`
- `data/worlds/æ±ŸåŸå¸‚/characters_list.json`
- `data/worlds/æ±ŸåŸå¸‚/characters/character_*.json` (8ä¸ªè§’è‰²æ–‡ä»¶)

**æç¤ºè¯æ–‡ä»¶:**
- `prompts/online/ws_system.txt` (WSç³»ç»Ÿæç¤ºè¯)
- `prompts/online/plot_system.txt` (Plotç³»ç»Ÿæç¤ºè¯)
- `prompts/online/vibe_system.txt` (Vibeç³»ç»Ÿæç¤ºè¯)

**è¾“å‡ºJSONæ–‡ä»¶:**
- `data/runtime/æ±ŸåŸå¸‚_20251201_183824/ws/world_state.json`
- `data/runtime/æ±ŸåŸå¸‚_20251201_183824/plot/current_scene.json`
- `data/runtime/æ±ŸåŸå¸‚_20251201_183824/plot/current_script.json`
- `data/runtime/æ±ŸåŸå¸‚_20251201_183824/vibe/initial_atmosphere.json`
- `data/runtime/æ±ŸåŸå¸‚_20251201_183824/init_summary.json`

---

## ğŸ® é˜¶æ®µ3: æ¸¸æˆè¿è¡Œå¾ªç¯

### æ¯å¹•çš„è°ƒç”¨é“¾

```
for scene_num in [1, 2, 3]:
    â”œâ”€> dispatch_script_to_actors()  [å‰§æœ¬æ‹†åˆ†]
    â”‚   â”œâ”€> è¯»å–: data/runtime/.../plot/current_scene.json
    â”‚   â”œâ”€> è¯»å–: data/runtime/.../plot/current_script.json
    â”‚   â”œâ”€> è¯»å–: data/runtime/.../ws/world_state.json
    â”‚   â”œâ”€> è¯»å–: prompts/online/script_divider.txt
    â”‚   â””â”€> ç”Ÿæˆ: data/runtime/.../npc/npc_001_script.json
    â”‚             data/runtime/.../npc/npc_002_script.json
    â”‚             (ä¸ºæ¯ä¸ªåœ¨åœºè§’è‰²ç”Ÿæˆå°å‰§æœ¬)
    â”‚
    â”œâ”€> initialize_first_appearance_characters()  [è§’è‰²åˆå§‹åŒ–]
    â”‚   â”œâ”€> è¯»å–: data/runtime/.../plot/current_scene.json
    â”‚   â”‚         (æå– first_appearance=true çš„è§’è‰²)
    â”‚   â”œâ”€> è¯»å–: data/worlds/æ±ŸåŸå¸‚/characters/character_npc_*.json
    â”‚   â”œâ”€> è¯»å–: prompts/online/npc_system.txt (é€šç”¨æ¨¡æ¿)
    â”‚   â”œâ”€> ç”Ÿæˆ: prompts/online/npc_prompt/npc_001_æ—æ™¨_prompt.txt
    â”‚   â”œâ”€> ç”Ÿæˆ: agents/online/layer3/npc_001_æ—æ™¨.py
    â”‚   â””â”€> æ³¨å†Œ: NPC Agent åˆ° OS
    â”‚
    â”œâ”€> run_scene_loop()  [åœºæ™¯æ¼”ç»]
    â”‚   â”œâ”€> åˆ›å»º: SceneMemory (åœºæ™¯è®°å¿†æ¿)
    â”‚   â”‚   â””â”€> æ–‡ä»¶: data/runtime/.../npc/memory/scene_memory.json
    â”‚   â”‚
    â”‚   â”œâ”€> å¾ªç¯å¯¹è¯:
    â”‚   â”‚   â”œâ”€> NPC Agent.react()
    â”‚   â”‚   â”‚   â”œâ”€> è¯»å–: prompts/online/npc_prompt/npc_001_æ—æ™¨_prompt.txt
    â”‚   â”‚   â”‚   â”œâ”€> è¯»å–: data/runtime/.../npc/npc_001_script.json
    â”‚   â”‚   â”‚   â”œâ”€> è¯»å–: data/runtime/.../npc/memory/scene_memory.json
    â”‚   â”‚   â”‚   â””â”€> ç”Ÿæˆ: å¯¹è¯å“åº” (thought, emotion, action, content)
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€> SceneMemory.add_dialogue()  [è®°å½•å¯¹è¯]
    â”‚   â”‚   â”‚   â””â”€> æ›´æ–°: scene_memory.json
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€> OS.route_dialogue()  [è·¯ç”±å†³ç­–]
    â”‚   â”‚   â”‚   â””â”€> å†³å®šä¸‹ä¸€ä½å‘è¨€è€…
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€> OS._save_actor_history()  [ä¿å­˜è§’è‰²å†å²]
    â”‚   â”‚       â””â”€> æ›´æ–°: data/runtime/.../npc/npc_001_æ—æ™¨/history.json
    â”‚   â”‚
    â”‚   â””â”€> åœºæ™¯ç»“æŸ
    â”‚
    â””â”€> process_scene_transition()  [å¹•é—´å¤„ç†] (ä»…å‰2å¹•)
        â”œâ”€> AllSceneMemory.archive_scene()  [å½’æ¡£åœºæ™¯è®°å¿†]
        â”‚   â””â”€> æ›´æ–°: data/runtime/.../all_scene_memory.json
        â”‚
        â”œâ”€> _update_world_state_from_scene()  [WSæ›´æ–°]
        â”‚   â”œâ”€> è¯»å–: prompts/online/ws_update_system.txt
        â”‚   â”œâ”€> è¯»å–: data/runtime/.../ws/world_state.json
        â”‚   â”œâ”€> è¯»å–: data/runtime/.../npc/memory/scene_memory.json
        â”‚   â””â”€> æ›´æ–°: data/runtime/.../ws/world_state.json
        â”‚
        â””â”€> _generate_next_scene_script()  [Plotç”Ÿæˆä¸‹ä¸€å¹•]
            â”œâ”€> _archive_plot_files()  [å½’æ¡£æ—§å‰§æœ¬] â­ **æ–°å¢åŠŸèƒ½**
            â”‚   â”œâ”€> è¯»å–: data/runtime/.../plot/current_scene.json
            â”‚   â”œâ”€> è¯»å–: data/runtime/.../plot/current_script.json
            â”‚   â””â”€> å½’æ¡£: data/runtime/.../plot/history/scene_X_timestamp.json
            â”‚            data/runtime/.../plot/history/script_X_timestamp.json
            â”‚
            â”œâ”€> è¯»å–: prompts/online/plot_system.txt
            â”œâ”€> è¯»å–: data/worlds/æ±ŸåŸå¸‚/world_setting.json
            â”œâ”€> è¯»å–: data/worlds/æ±ŸåŸå¸‚/characters_list.json
            â”œâ”€> è¯»å–: data/worlds/æ±ŸåŸå¸‚/characters/character_*.json
            â”œâ”€> è¯»å–: data/runtime/.../ws/world_state.json
            â”œâ”€> è¯»å–: data/runtime/.../all_scene_memory.json
            â”œâ”€> è¯»å–: data/runtime/.../npc/memory/scene_memory.json
            â”œâ”€> è§£æè§’è‰²ç™»åœºä¿¡æ¯ (å…¥åœº/åœ¨åœº/ç¦»åœº) â­ **å·²ä¿®å¤**
            â””â”€> ç”Ÿæˆ: data/runtime/.../plot/current_scene.json (æ–°)
                 data/runtime/.../plot/current_script.json (æ–°)
```

### æ–‡ä»¶ç”Ÿæˆæ¸…å•ï¼ˆæ¯å¹•ï¼‰

**è¾“å…¥æ–‡ä»¶:**
- `data/runtime/.../plot/current_scene.json` (å½“å‰åœºæ™¯)
- `data/runtime/.../plot/current_script.json` (å½“å‰å‰§æœ¬)
- `data/runtime/.../ws/world_state.json` (ä¸–ç•ŒçŠ¶æ€)
- `data/worlds/æ±ŸåŸå¸‚/characters/character_*.json` (è§’è‰²æ¡£æ¡ˆ)
- `data/runtime/.../npc/memory/scene_memory.json` (åœºæ™¯è®°å¿†)

**æç¤ºè¯æ–‡ä»¶:**
- `prompts/online/script_divider.txt` (å‰§æœ¬æ‹†åˆ†æç¤ºè¯)
- `prompts/online/npc_system.txt` (NPCé€šç”¨æç¤ºè¯æ¨¡æ¿)
- `prompts/online/npc_prompt/npc_001_æ—æ™¨_prompt.txt` (è§’è‰²ä¸“å±æç¤ºè¯ï¼ŒåŠ¨æ€ç”Ÿæˆ)
- `prompts/online/ws_update_system.txt` (WSæ›´æ–°æç¤ºè¯)
- `prompts/online/plot_system.txt` (Plotç³»ç»Ÿæç¤ºè¯)

**è¾“å‡ºJSONæ–‡ä»¶:**
- `data/runtime/.../npc/npc_001_script.json` (è§’è‰²å°å‰§æœ¬)
- `data/runtime/.../npc/memory/scene_memory.json` (åœºæ™¯è®°å¿†ï¼ŒæŒç»­æ›´æ–°)
- `data/runtime/.../npc/npc_001_æ—æ™¨/history.json` (è§’è‰²å†å²ï¼ŒæŒç»­æ›´æ–°)
- `data/runtime/.../all_scene_memory.json` (å…¨å‰§è®°äº‹æ¿ï¼Œå¹•é—´æ›´æ–°)
- `data/runtime/.../ws/world_state.json` (ä¸–ç•ŒçŠ¶æ€ï¼Œå¹•é—´æ›´æ–°)
- `data/runtime/.../plot/history/scene_X_timestamp.json` (å½’æ¡£åœºæ™¯) â­ **æ–°å¢**
- `data/runtime/.../plot/history/script_X_timestamp.json` (å½’æ¡£å‰§æœ¬) â­ **æ–°å¢**
- `data/runtime/.../plot/current_scene.json` (æ–°åœºæ™¯ï¼Œå¹•é—´ç”Ÿæˆ)
- `data/runtime/.../plot/current_script.json` (æ–°å‰§æœ¬ï¼Œå¹•é—´ç”Ÿæˆ)

**åŠ¨æ€ç”Ÿæˆæ–‡ä»¶:**
- `prompts/online/npc_prompt/npc_001_æ—æ™¨_prompt.txt` (é¦–æ¬¡å‡ºåœºæ—¶ç”Ÿæˆ)
- `agents/online/layer3/npc_001_æ—æ™¨.py` (é¦–æ¬¡å‡ºåœºæ—¶ç”Ÿæˆ)

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### è¾“å…¥æ–‡ä»¶ï¼ˆé™æ€ï¼‰

| æ–‡ä»¶è·¯å¾„ | ç”¨é€” | æ¥æº |
|---------|------|------|
| `data/novels/example_novel.txt` | å°è¯´åŸæ–‡ | ç”¨æˆ·æä¾› |
| `prompts/offline/creatorGod/character_filter.txt` | å¤§ä¸­æ­£æç¤ºè¯ | é¡¹ç›®æ–‡ä»¶ |
| `prompts/offline/creatorGod/world_setting.txt` | Demiurgeæç¤ºè¯ | é¡¹ç›®æ–‡ä»¶ |
| `prompts/offline/creatorGod/character_detail.txt` | è®¸åŠ­æç¤ºè¯ | é¡¹ç›®æ–‡ä»¶ â­ **å·²ä¼˜åŒ–** |
| `prompts/online/ws_system.txt` | WSç³»ç»Ÿæç¤ºè¯ | é¡¹ç›®æ–‡ä»¶ |
| `prompts/online/plot_system.txt` | Plotç³»ç»Ÿæç¤ºè¯ | é¡¹ç›®æ–‡ä»¶ |
| `prompts/online/vibe_system.txt` | Vibeç³»ç»Ÿæç¤ºè¯ | é¡¹ç›®æ–‡ä»¶ |
| `prompts/online/script_divider.txt` | å‰§æœ¬æ‹†åˆ†æç¤ºè¯ | é¡¹ç›®æ–‡ä»¶ |
| `prompts/online/npc_system.txt` | NPCé€šç”¨æ¨¡æ¿ | é¡¹ç›®æ–‡ä»¶ |
| `prompts/online/ws_update_system.txt` | WSæ›´æ–°æç¤ºè¯ | é¡¹ç›®æ–‡ä»¶ |

### ç”Ÿæˆæ–‡ä»¶ï¼ˆåŠ¨æ€ï¼‰

#### CreatorGodé˜¶æ®µç”Ÿæˆ

| æ–‡ä»¶è·¯å¾„ | ç”¨é€” | ç”Ÿæˆæ—¶æœº |
|---------|------|---------|
| `data/worlds/æ±ŸåŸå¸‚/characters_list.json` | è§’è‰²åˆ—è¡¨ | é˜¶æ®µ1å®Œæˆ |
| `data/worlds/æ±ŸåŸå¸‚/world_setting.json` | ä¸–ç•Œè®¾å®š | é˜¶æ®µ2å®Œæˆ |
| `data/worlds/æ±ŸåŸå¸‚/characters/character_npc_*.json` | è§’è‰²æ¡£æ¡ˆ | é˜¶æ®µ3å®Œæˆ (8ä¸ªæ–‡ä»¶) |

#### Illuminatié˜¶æ®µç”Ÿæˆ

| æ–‡ä»¶è·¯å¾„ | ç”¨é€” | ç”Ÿæˆæ—¶æœº |
|---------|------|---------|
| `data/runtime/æ±ŸåŸå¸‚_xxx/ws/world_state.json` | åˆå§‹ä¸–ç•ŒçŠ¶æ€ | WSåˆå§‹åŒ– |
| `data/runtime/æ±ŸåŸå¸‚_xxx/plot/current_scene.json` | èµ·å§‹åœºæ™¯ | Plotåˆå§‹åŒ– |
| `data/runtime/æ±ŸåŸå¸‚_xxx/plot/current_script.json` | èµ·å§‹å‰§æœ¬ | Plotåˆå§‹åŒ– |
| `data/runtime/æ±ŸåŸå¸‚_xxx/vibe/initial_atmosphere.json` | åˆå§‹æ°›å›´ | Vibeåˆå§‹åŒ– |
| `data/runtime/æ±ŸåŸå¸‚_xxx/init_summary.json` | åˆå§‹åŒ–æ‘˜è¦ | åˆå§‹åŒ–å®Œæˆ |

#### æ¸¸æˆè¿è¡Œé˜¶æ®µç”Ÿæˆ

| æ–‡ä»¶è·¯å¾„ | ç”¨é€” | ç”Ÿæˆæ—¶æœº |
|---------|------|---------|
| `data/runtime/.../npc/npc_001_script.json` | è§’è‰²å°å‰§æœ¬ | æ¯å¹•å¼€å§‹ |
| `data/runtime/.../npc/memory/scene_memory.json` | åœºæ™¯è®°å¿† | æ¯å¹•æŒç»­æ›´æ–° |
| `data/runtime/.../npc/npc_001_æ—æ™¨/history.json` | è§’è‰²å†å² | æ¯æ¬¡å¯¹è¯åæ›´æ–° |
| `data/runtime/.../all_scene_memory.json` | å…¨å‰§è®°äº‹æ¿ | å¹•é—´æ›´æ–° |
| `data/runtime/.../ws/world_state.json` | ä¸–ç•ŒçŠ¶æ€ | å¹•é—´æ›´æ–° |
| `data/runtime/.../plot/history/scene_X_timestamp.json` | å½’æ¡£åœºæ™¯ | å¹•é—´å½’æ¡£ â­ **æ–°å¢** |
| `data/runtime/.../plot/history/script_X_timestamp.json` | å½’æ¡£å‰§æœ¬ | å¹•é—´å½’æ¡£ â­ **æ–°å¢** |
| `data/runtime/.../plot/current_scene.json` | å½“å‰åœºæ™¯ | å¹•é—´æ›´æ–° |
| `data/runtime/.../plot/current_script.json` | å½“å‰å‰§æœ¬ | å¹•é—´æ›´æ–° |
| `prompts/online/npc_prompt/npc_001_æ—æ™¨_prompt.txt` | è§’è‰²ä¸“å±æç¤ºè¯ | é¦–æ¬¡å‡ºåœº |
| `agents/online/layer3/npc_001_æ—æ™¨.py` | NPC Agentä»£ç  | é¦–æ¬¡å‡ºåœº |

---

## ğŸ“ æç¤ºè¯æ¸…å•

### ç¦»çº¿é˜¶æ®µï¼ˆCreatorGodï¼‰

| æç¤ºè¯æ–‡ä»¶ | Agent | ç”¨é€” | è¾“å…¥æ•°æ® |
|-----------|-------|------|---------|
| `prompts/offline/creatorGod/character_filter.txt` | å¤§ä¸­æ­£ | è§’è‰²æ™®æŸ¥ | å°è¯´æ–‡æœ¬ |
| `prompts/offline/creatorGod/world_setting.txt` | Demiurge | ä¸–ç•Œè®¾å®šæå– | å°è¯´æ–‡æœ¬ |
| `prompts/offline/creatorGod/character_detail.txt` | è®¸åŠ­ | è§’è‰²æ¡£æ¡ˆç”Ÿæˆ | å°è¯´æ–‡æœ¬ + è§’è‰²åˆ—è¡¨ â­ **å·²ä¼˜åŒ–** |

### åœ¨çº¿é˜¶æ®µï¼ˆIlluminati + æ¸¸æˆè¿è¡Œï¼‰

| æç¤ºè¯æ–‡ä»¶ | Agent | ç”¨é€” | è¾“å…¥æ•°æ® |
|-----------|-------|------|---------|
| `prompts/online/ws_system.txt` | WS | åˆå§‹ä¸–ç•ŒçŠ¶æ€ç”Ÿæˆ | world_setting + characters_list |
| `prompts/online/plot_system.txt` | Plot | å‰§æœ¬ç”Ÿæˆ | world_setting + characters + world_state + story_history |
| `prompts/online/vibe_system.txt` | Vibe | æ°›å›´ç”Ÿæˆ | world_setting + current_scene |
| `prompts/online/script_divider.txt` | OS | å‰§æœ¬æ‹†åˆ† | current_scene + current_script + world_state |
| `prompts/online/npc_system.txt` | NPC | NPCé€šç”¨æ¨¡æ¿ | (ä½œä¸ºæ¨¡æ¿ï¼ŒåŠ¨æ€å¡«å……è§’è‰²æ•°æ®) |
| `prompts/online/npc_prompt/npc_001_æ—æ™¨_prompt.txt` | NPC | è§’è‰²ä¸“å±æç¤ºè¯ | (åŠ¨æ€ç”Ÿæˆï¼ŒåŸºäºcharacter_npc_001.json) |
| `prompts/online/ws_update_system.txt` | WS | ä¸–ç•ŒçŠ¶æ€æ›´æ–° | current_world_state + scene_memory |

---

## ğŸ“Š JSONæ–‡ä»¶æ¸…å•

### ä¸–ç•Œæ•°æ®ï¼ˆdata/worlds/æ±ŸåŸå¸‚/ï¼‰

| æ–‡ä»¶å | ç»“æ„ | ç”¨é€” |
|-------|------|------|
| `characters_list.json` | `List[Dict]` | è§’è‰²åˆ—è¡¨ï¼ŒåŒ…å«IDã€åç§°ã€é‡è¦æ€§ |
| `world_setting.json` | `Dict` | ä¸–ç•Œè®¾å®šï¼šåœ°ç‚¹ã€è§„åˆ™ã€ç‰©ç†æ³•åˆ™ |
| `characters/character_npc_001.json` | `Dict` | æ—æ™¨çš„è¯¦ç»†æ¡£æ¡ˆ |
| `characters/character_npc_002.json` | `Dict` | è‹æ™´é›¨çš„è¯¦ç»†æ¡£æ¡ˆ |
| ... (å…±8ä¸ªè§’è‰²æ–‡ä»¶) | `Dict` | å…¶ä»–è§’è‰²çš„è¯¦ç»†æ¡£æ¡ˆ |

### è¿è¡Œæ—¶æ•°æ®ï¼ˆdata/runtime/æ±ŸåŸå¸‚_xxx/ï¼‰

| æ–‡ä»¶å | ç»“æ„ | ç”¨é€” |
|-------|------|------|
| `ws/world_state.json` | `Dict` | å½“å‰ä¸–ç•ŒçŠ¶æ€ï¼ˆåœºæ™¯ã€å¤©æ°”ã€æ—¶é—´ç­‰ï¼‰ |
| `plot/current_scene.json` | `Dict` | å½“å‰åœºæ™¯é…ç½®ï¼ˆåœ°ç‚¹ã€åœ¨åœºè§’è‰²ç­‰ï¼‰ |
| `plot/current_script.json` | `Dict` | å½“å‰å‰§æœ¬å†…å®¹ |
| `plot/history/scene_X_timestamp.json` | `Dict` | å½’æ¡£çš„åœºæ™¯æ–‡ä»¶ â­ **æ–°å¢** |
| `plot/history/script_X_timestamp.json` | `Dict` | å½’æ¡£çš„å‰§æœ¬æ–‡ä»¶ â­ **æ–°å¢** |
| `vibe/initial_atmosphere.json` | `Dict` | åˆå§‹æ°›å›´æå†™ |
| `npc/memory/scene_memory.json` | `Dict` | åœºæ™¯è®°å¿†æ¿ï¼ˆå¯¹è¯è®°å½•ï¼‰ |
| `npc/npc_001_script.json` | `Dict` | æ—æ™¨çš„å°å‰§æœ¬ |
| `npc/npc_001_æ—æ™¨/history.json` | `Dict` | æ—æ™¨çš„å†å²æ¼”ç»è®°å½• |
| `all_scene_memory.json` | `Dict` | å…¨å‰§è®°äº‹æ¿ï¼ˆæ‰€æœ‰å¹•çš„è®°å½•ï¼‰ |
| `init_summary.json` | `Dict` | åˆå§‹åŒ–æ‘˜è¦ |

---

## ğŸ”„ å…³é”®è°ƒç”¨å…³ç³»

### 1. è§’è‰²è§£æé€»è¾‘ï¼ˆå·²ä¿®å¤ï¼‰

**ä½ç½®**: `initial_Illuminati.py` å’Œ `os_agent.py`

**é—®é¢˜**: ä¹‹å‰åªè§£æ"å…¥åœº"å’Œ"åœ¨åœº"è§’è‰²ï¼Œå¿½ç•¥äº†"ç¦»åœº"è§’è‰²

**ä¿®å¤**: æ–°å¢ `exit_pattern` æ­£åˆ™è¡¨è¾¾å¼ï¼Œè§£æç¦»åœºè§’è‰²

```python
# è§£æå…¥åœºè§’è‰²
entry_pattern = r'\*\*å…¥åœº\*\*:\s*(\S+)\s*\((\w+)\)\s*\[First Appearance:\s*(True|False)\]'

# è§£æåœ¨åœºè§’è‰²
present_pattern = r'\*\*åœ¨åœº\*\*:\s*(\S+)\s*\((\w+)\)'

# è§£æç¦»åœºè§’è‰² â­ æ–°å¢
exit_pattern = r'\*\*ç¦»åœº\*\*:\s*(\S+)\s*\((\w+)\)'
```

### 2. å‰§æœ¬å½’æ¡£é€»è¾‘ï¼ˆæ–°å¢åŠŸèƒ½ï¼‰

**ä½ç½®**: `os_agent.py` çš„ `_archive_plot_files()` æ–¹æ³•

**åŠŸèƒ½**: åœ¨ç”Ÿæˆæ–°å‰§æœ¬å‰ï¼Œè‡ªåŠ¨å½’æ¡£æ—§å‰§æœ¬åˆ° `plot/history/` ç›®å½•

**æ–‡ä»¶åæ ¼å¼**: 
- `scene_{scene_id}_{timestamp}.json`
- `script_{scene_id}_{timestamp}.json`

### 3. JSONç”Ÿæˆç¨³å®šæ€§ï¼ˆå·²ä¼˜åŒ–ï¼‰

**ä½ç½®**: `prompts/offline/creatorGod/character_detail.txt`

**ä¼˜åŒ–**: åœ¨ Critical Constraints ä¸­æ–°å¢ç¬¬ä¸€æ¡ï¼š
```
1. **Output Format:** Output ONLY the raw JSON object. 
   Do not wrap it in markdown code blocks (like ```json ... ```). 
   Do not include any explanations before or after the JSON.
```

**æ•ˆæœ**: æ˜¾è‘—å‡å°‘JSONè§£æé”™è¯¯ï¼Œæœ¬æ¬¡æµ‹è¯•ä¸­8ä¸ªè§’è‰²å…¨éƒ¨ä¸€æ¬¡æ€§æˆåŠŸç”Ÿæˆ

---

## ğŸ“ˆ æµ‹è¯•ç»“æœç»Ÿè®¡

### CreatorGodé˜¶æ®µ
- âœ… è§’è‰²æ™®æŸ¥: 8ä¸ªè§’è‰²
- âœ… ä¸–ç•Œè®¾å®š: æˆåŠŸç”Ÿæˆ
- âœ… è§’è‰²æ¡£æ¡ˆ: 8/8 æˆåŠŸï¼ˆæ— é‡è¯•ï¼‰

### Illuminatié˜¶æ®µ
- âœ… WSåˆå§‹åŒ–: æˆåŠŸ
- âœ… Plotåˆå§‹åŒ–: æˆåŠŸï¼ˆè¯†åˆ«3ä¸ªè§’è‰²ï¼šæ—æ™¨ã€è‹æ™´é›¨ã€ç©å®¶ï¼‰
- âœ… Vibeåˆå§‹åŒ–: æˆåŠŸ

### æ¸¸æˆè¿è¡Œé˜¶æ®µ
- âœ… ç¬¬1å¹•: 4è½®å¯¹è¯ï¼Œ2ä¸ªNPCå‚ä¸
- âœ… ç¬¬2å¹•: 4è½®å¯¹è¯ï¼Œ1ä¸ªNPCå‚ä¸
- âœ… ç¬¬3å¹•: 1è½®å¯¹è¯ï¼Œ1ä¸ªNPCå‚ä¸
- âœ… å¹•é—´å¤„ç†: 2æ¬¡æˆåŠŸï¼ˆå½’æ¡£ã€WSæ›´æ–°ã€Plotç”Ÿæˆï¼‰
- âœ… å‰§æœ¬å½’æ¡£: 4ä¸ªæ–‡ä»¶ï¼ˆ2å¹• Ã— 2æ–‡ä»¶ï¼‰

---

## ğŸ¯ å…³é”®æ”¹è¿›ç‚¹

1. **è§’è‰²è§£æä¿®å¤**: æ­£ç¡®å¤„ç†ç¦»åœºè§’è‰²ï¼Œç¡®ä¿æ‰€æœ‰æœ‰æˆä»½çš„è§’è‰²éƒ½è¢«åˆå§‹åŒ–
2. **å‰§æœ¬å½’æ¡£åŠŸèƒ½**: è‡ªåŠ¨ä¿å­˜å†å²å‰§æœ¬ï¼Œä¾¿äºå›æº¯å’Œè°ƒè¯•
3. **JSONç”Ÿæˆç¨³å®šæ€§**: ä¼˜åŒ–Promptï¼Œå‡å°‘è§£æé”™è¯¯
4. **æµ‹è¯•æµç¨‹å®Œæ•´æ€§**: ä»CreatorGodåˆ°Illuminatiå†åˆ°æ¸¸æˆè¿è¡Œï¼Œå®Œæ•´è¦†ç›–

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025-12-01  
**æµ‹è¯•ç‰ˆæœ¬**: v0.8.10  
**çŠ¶æ€**: âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

